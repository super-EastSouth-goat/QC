# 边缘API模拟指南

## 概述

当系统检测到没有配置真实的边缘API时，会自动启用智能模拟模式。这个模拟系统提供了丰富的功能来支持开发、测试和演示。

## 🎯 模拟模式

### 1. 随机模式 (Random)
- **特点**: 完全随机的结果
- **用途**: 基础功能测试
- **行为**: 随机生成PASS/FAIL结果和置信度

### 2. 真实模式 (Realistic)
- **特点**: 基于条形码特征的智能结果
- **用途**: 接近真实场景的测试
- **行为**: 
  - `test/demo` → 高通过率 (90%)
  - `batch/b` → 正常通过率 (75%)
  - `sample/s` → 严格检测 (60%)
  - `urgent/u` → 快速检测 (80%)

### 3. 演示模式 (Demo)
- **特点**: 一致性结果，适合演示
- **用途**: 产品展示和培训
- **行为**: 相同条形码总是返回相同结果

### 4. 测试模式 (Testing)
- **特点**: 可预测的结果
- **用途**: 自动化测试
- **行为**:
  - `PASS-*` → 强制通过
  - `FAIL-*` → 强制失败
  - `ERROR-*` → 触发错误

## 🛠️ 配置选项

### 通过率 (Pass Rate)
- **范围**: 0% - 100%
- **默认**: 75%
- **说明**: 控制质检通过的概率

### 错误率 (Error Rate)
- **范围**: 0% - 20%
- **默认**: 5%
- **说明**: 模拟API调用失败的概率

### 响应延迟 (Delay)
- **最小延迟**: 默认 800ms
- **最大延迟**: 默认 3000ms
- **说明**: 模拟网络延迟和处理时间

### 置信度范围 (Confidence Range)
- **最小值**: 默认 0.6
- **最大值**: 默认 0.98
- **说明**: AI分析结果的置信度范围

## 🎮 使用界面

### 模拟API配置面板
1. 点击右下角的 ⚙️ 按钮打开配置面板
2. 调整各项参数
3. 使用预设配置快速切换模式

### 测试场景面板
1. 点击右下角的 ✅ 按钮打开测试面板
2. 选择测试类别：
   - **基础测试**: 标准的通过/失败场景
   - **边界情况**: 特殊字符、长条形码等
   - **错误场景**: API错误、超时等
   - **性能测试**: 快速/慢速响应
3. 点击场景或使用随机选择

## 📋 预设配置

### 开发模式 (Development)
```json
{
  "mode": "realistic",
  "delay": { "min": 500, "max": 1500 },
  "passRate": 0.8,
  "errorRate": 0.02
}
```

### 演示模式 (Demo)
```json
{
  "mode": "demo",
  "delay": { "min": 1000, "max": 2500 },
  "passRate": 0.7,
  "errorRate": 0.03
}
```

### 测试模式 (Testing)
```json
{
  "mode": "testing",
  "delay": { "min": 100, "max": 500 },
  "passRate": 0.5,
  "errorRate": 0.1
}
```

### 生产模拟 (Production)
```json
{
  "mode": "realistic",
  "delay": { "min": 1500, "max": 4000 },
  "passRate": 0.75,
  "errorRate": 0.05
}
```

## 🧪 测试场景示例

### 基础测试
- `PASS-STANDARD-001` → 标准通过
- `FAIL-STANDARD-001` → 标准失败
- `TEST-PRODUCT-123` → 测试产品
- `BATCH-B001-456` → 批次产品

### 边界情况
- `VERY-LONG-BARCODE-XXXXXXXXXX...` → 超长条形码
- `TEST-特殊字符-@#$%` → 特殊字符
- `1234567890123` → 纯数字

### 错误场景
- `ERROR-API-500` → 触发API错误
- `ERROR-TIMEOUT-001` → 模拟超时

## 🔧 编程接口

### 切换模拟模式
```typescript
import { edgeApiService } from '@/lib/services';

// 切换到演示模式
edgeApiService.switchMockMode('demo');

// 更新配置
edgeApiService.updateMockConfig({
  passRate: 0.9,
  delay: { min: 500, max: 1000 }
});

// 重置为预设
edgeApiService.resetMockConfig('development');
```

### 获取配置
```typescript
const config = edgeApiService.getMockConfig();
console.log('当前模拟配置:', config);
```

## 💡 最佳实践

### 开发阶段
1. 使用 **开发模式** 进行日常开发
2. 调整通过率测试不同场景
3. 使用测试场景验证边界情况

### 演示阶段
1. 切换到 **演示模式** 确保结果一致
2. 准备几个典型的测试条形码
3. 调整延迟模拟真实环境

### 测试阶段
1. 使用 **测试模式** 进行自动化测试
2. 利用预定义的测试场景
3. 验证错误处理逻辑

### 部署准备
1. 使用 **生产模拟** 进行最终测试
2. 验证在真实延迟下的用户体验
3. 测试各种网络条件

## 🚀 迁移到真实API

当准备连接真实的边缘API时：

1. **配置环境变量**:
   ```env
   EDGE_API_URL=https://your-edge-api.com/api
   ```

2. **验证API接口**:
   - 确保API返回正确的响应格式
   - 测试错误处理和超时场景

3. **逐步迁移**:
   - 先在测试环境验证
   - 对比模拟结果和真实结果
   - 调整前端逻辑适配真实API

4. **监控和调试**:
   - 查看 `job_events` 表的API调用日志
   - 监控响应时间和错误率
   - 根据实际情况调整重试策略

## 🔍 故障排除

### 模拟不工作
- 检查是否在演示模式下
- 确认 `EDGE_API_URL` 环境变量为空或无效

### 结果不符合预期
- 检查当前模拟模式和配置
- 验证条形码是否匹配测试场景
- 查看浏览器控制台的日志

### 性能问题
- 调整延迟范围
- 降低错误率
- 使用测试模式进行快速验证

通过这个智能模拟系统，你可以在没有真实边缘API的情况下完整地开发、测试和演示质检系统的所有功能！